# OpenLayers 統合計測・伝搬計算 取扱説明書

## 1. 概要

本プログラムは OpenLayers ライブラリを用いて、地図上で2点間の電波伝搬経路・標高断面図・伝搬損失計算などの解析を行うためのWebアプリケーションです。  
日本語UIに対応し、海上・都市・長距離通信など各種無線シナリオに対応したプリセット計算機能も搭載しています。

## 2. 主な機能

- 地図表示（OpenStreetMap・国土地理院タイル切替）
- 2点間のクリックによる測定経路設定
- 標高断面図・電波伝搬経路の可視化
- 伝搬損失計算（自由空間損失・Two-ray・ITU-R P.526回折損失モデル）
- 受信電力レベルの計算・グラフ表示
- パラメータプリセット（海上通信・都市内LTE・長距離リンク）
- 可動式ウィンドウによるコントロール・結果表示

## 3. 画面構成

- 地図領域：画面全体に地図を表示
- 左下：「ベースマップ切り替え」コントロール
- 右上：「伝搬計算コントロール」パネル  
  - 周波数、アンテナ高、出力、利得・損失など各種パラメータ入力
  - 無線シナリオプリセットボタン
  - 伝搬計算実行ボタン
- 右側：「計測結果ポップアップ」ウィンドウ  
  - 伝搬計算結果・座標・標高等の詳細
- 左上：「標高断面図ポップアップ」ウィンドウ  
  - 地形断面図・レベルダイヤグラムグラフ

## 4. 主な操作方法

### 4.1 地図の利用

1. ベースマップ、タイルソースの切り替えは左下コントロールで行います。
2. 地図上の任意の2点をクリックして測定経路を設定してください。

### 4.2 パラメータ入力

1. 右上の「伝搬計算コントロール」パネルで、周波数・アンテナ高・出力・利得・損失（Tx/Rx側）などを入力します。
2. シナリオプリセットボタンを押すと代表的な値が自動セットされます。

### 4.3 伝搬計算の実行

1. 2点間を選択した後、「伝搬計算実行 (Two-Ray切替)」ボタンを押してください。
2. 結果ウィンドウに伝搬損失・受信電力・仰俯角・断面図などが表示されます。

### 4.4 結果ウィンドウの操作

- 各ウィンドウはヘッダー部分のドラッグで移動可能です。
- 「✖」ボタンでウィンドウを閉じられます。

## 5. 計算モデルの詳細

- **自由空間損失 (FSPL)**  
  標高障害がない場合に適用されます。
- **Two-Rayモデル**  
  アンテナ高が十分高く、障害物がない遠距離の場合に適用されます。
- **ITU-R P.526回折損失**  
  経路途中に地形障害がある場合、フレネルゾーン・回折損失を計算します。

## 6. 各種座標系・標高データ

- **座標表示**  
  - 緯度経度（WGS84）
  - UTM座標
  - MGRS座標
- **標高データ**  
  - 国土地理院 DEM APIより取得（APIエラー時は0mとして補正）

## 7. よくある質問・トラブル対策

- 地図が表示されない場合  
  → ネットワーク環境、タイルURLの有効性をご確認ください。
- 標高が「0m」しか表示されない  
  → API障害または測定地点が海上・低地の場合に発生します。
- ポップアップが動かない  
  → ヘッダー以外の部分ではドラッグできません。

## 8. 参考文献・ライブラリ

- [OpenLayers](https://openlayers.org/)
- [Chart.js](https://www.chartjs.org/)
- [proj4js](https://proj4js.org/)
- [mgrs.js](https://github.com/proj4js/mgrs.js)
- [国土地理院 地理院タイル](https://maps.gsi.go.jp/development/ichiran.html)
- ITU-R Recommendation P.526

---

**本マニュアル内容は2025年10月時点の仕様に基づきます。最新情報はGitHubリポジトリをご確認ください。**
